(()=>{"use strict";const e=new class{historyArrayBlack=[];historyArrayWhite=[];Add(e,t,r,o){const a=t;let i,c=a.type[0].toUpperCase();switch("knight"===a.type&&(c="N"),e){case"regular":i="pawn"!==a.type?c+r:r;break;case"capture":i="pawn"!==a.type?c+":"+r:o?o[0]+":"+r:a.id[0]+":"+r;break;case"castling-queen":i="0-0-0";break;case"castling-king":i="0-0"}"white"===a.color?this.historyArrayWhite.push(i):this.historyArrayBlack.push(i),this.Render()}AddPromotion(e,t){const r=t+"Q";"white"===e?this.historyArrayWhite.push(r):this.historyArrayBlack.push(r),this.Render()}AddPromotionCapture(e,t,r){const o=e[0]+":"+r+"Q";"white"===t?this.historyArrayWhite.push(o):this.historyArrayBlack.push(o),this.Render()}ResetHistory(){document.getElementById("blackHistory").innerHTML="",document.getElementById("whiteHistory").innerHTML="",this.historyArrayBlack=[],this.historyArrayWhite=[]}Render(){const e=document.getElementById("blackHistory");e.innerHTML="";const t=document.getElementById("whiteHistory");t.innerHTML="",e.length>35&&e.shift(),t.length>35&&t.shift(),this.historyArrayBlack.forEach((t=>{const r=document.createElement("div");r.innerText=t,r.id="history",e.appendChild(r)})),this.historyArrayWhite.forEach((e=>{const r=document.createElement("div");r.innerText=e,r.id="history",t.appendChild(r)}))}},t=function(){const e=document.getElementById("myCanvas");e.style.backgroundColor="rgb(148, 106, 62)";const t=e.getContext("2d"),r=100,o={king:{black:"♚",white:"♔"},queen:{black:"♛",white:"♕"},rook:{black:"♜",white:"♖"},bishop:{black:"♝",white:"♗"},knight:{black:"♞",white:"♘"},pawn:{black:"♟",white:"♙"}},a=["a","b","c","d","e","f","g","h"],i=[8,7,6,5,4,3,2,1];return{clear:function(){t.clearRect(0,0,e.width,e.height)},figuresDraw:function(e){t.save(),e.forEach((e=>{t.fillStyle="black",t.font="100px serif",t.textAlign="center",t.fillText(o[e.type][e.color],75+e.x*r,110+e.y*r)})),t.restore()},createCheckBoard:function(e){let o=!0;for(let e=0;e<8;e++){const c=e*r;t.fillStyle="black",t.font="25px Arial",t.fillText(a[e],68+c,20),t.fillText(a[e],68+c,844),t.fillText(i[e],5,80+c),t.fillText(i[e],831,80+c);for(let e=0;e<8;e++){const a=e*r;t.fillStyle=o?"rgb(209, 173, 90)":"rgb(94, 57, 19)",t.fillRect(25+a,25+c,r,r),o=!o}o=!o}Object.entries(e.boardSquare).forEach((e=>{delete e[1].canMove}))},fillSquare:function(e,o,a){t.fillStyle=a,e<10&&o<10?t.fillRect(25+100*e,25+100*o,r,r):t.fillRect(e,o,r,r)},pixelsToNumbers:function(e,t){const o=e-25,a=t-25;return[Math.trunc(o/r),Math.trunc(a/r)]},numberToPixels:function(e,t){return[e*r+25,t*r+35]},addEventListener:(t,r,o)=>e.addEventListener(t,r,o),letters:a,numbers:i}}(),r={boardSquare:{},figures:[],currentTurn:"white",enPassantStorage:[],arrayOfMoves:[],check:!1};let o=!1,a=[!1];function i(e,t,o,a){let i=!0;r.figures.forEach((t=>{e===t.id&&(i=!1)})),i&&a?r.figures.push({id:e,type:o,color:t,castling:a}):i&&r.figures.push({id:e,type:o,color:t}),c(e),u()}function c(o,i){const c=h(o);if(a[0]=!1,o&&i){const c=r.boardSquare[i],u=r.boardSquare[o],s=h(i);a=[!1,s.color,i,o];let l=!0,b="regular";if(u.occupied&&(b="capture",a[0]=!0),"pawn"===s.type&&(l=function(e,o){if("white"===e.color&&"8"===o[1]||"black"===e.color&&"1"===o[1])return function(e){if(!r.boardSquare[e])return;const o=t.numberToPixels(r.boardSquare[e].x,r.boardSquare[e].y),a=o[0],i=o[1],c=document.getElementById("promotion").style,n=document.getElementById("yesButton"),d=document.getElementById("noButton");n.dataset.squareId=e,d.dataset.squareId=e,c.display="initial",c.left=a+"px",c.top=i+"px",p("yes")}(o),!1}(s,o),l=function(t,o){const a=h(t);let i;if(Math.abs(Number(t[1])-Number(o[1]))>1)return a.enPassant=!0,r.enPassantStorage.push(a),!0;if(t[0]!==o[0]){if("white"===a.color){if(i=o[0]+(Number(o[1])-1),!h(i))return!0;"white"!==h(i).color&&h(i).enPassant&&n(i)}else{if(i=o[0]+(Number(o[1])+1),!h(i))return!0;"black"!==h(i).color&&h(i).enPassant&&n(i)}return e.Add("capture",a,o),!1}return!0}(i,o)),s!==r.enPassantStorage[0]&&r.enPassantStorage[0]){const e=r.enPassantStorage[0].id;r.figures.forEach((t=>{t.id===e&&delete t.enPassant})),r.enPassantStorage.shift()}"rook"===s.type&&delete s.castling,"king"===s.type&&(delete s.castling,l=function(t,r){let o=!0;const a=t.id;return"white"===t.color?"e1"===a&&"g1"===r?(g("f1","h1"),e.Add("castling-king",t,t.id),o=!1):"e1"===a&&"c1"===r&&(g("d1","a1"),e.Add("castling-queen",t,t.id),o=!1):"black"===t.color&&("e8"===a&&"g8"===r?(g("f8","h8"),e.Add("castling-king",t,t.id),o=!1):"e8"===a&&"c8"===r&&(g("d8","a8"),e.Add("castling-queen",t,t.id),o=!1)),o}(s,o)),l&&e.Add(b,s,o),n(o),s.x=u.x,s.y=u.y,s.id=u.id,u.occupied=!0,delete c.occupied,d()}var u;i||(r.boardSquare[o].occupied=!0,c.x=r.boardSquare[o].x,c.y=r.boardSquare[o].y),(u=r).arrayOfMoves=[],u.figures.forEach((e=>{s(e.id)})),Object.entries(u.boardSquare).forEach((e=>{e[1].canMove&&u.arrayOfMoves.push(e[1].id)})),function(){let e;Object.entries(r.boardSquare).forEach((e=>{e[1].check&&delete e[1].check}));const t={};r.figures.forEach((e=>{"king"===e.type&&("white"===e.color?t.white=e:t.black=e)})),Object.entries(t).forEach((t=>{const o=t[1];r.boardSquare[o.id].canMove&&(r.check=!0,r.boardSquare[o.id].check=!0,e=t[1])})),e||(r.check=!1)}()}function n(e){"all"===e&&(r.figures=[],Object.entries(r.boardSquare).forEach((e=>delete e[1].occupied)),d("white")),r.figures=r.figures.filter((t=>e!==t.id||(delete r.boardSquare[e].occupied,!1))),u()}function d(e){const t=document.getElementById("turnCount");if(e)return r.currentTurn=e,void(t.innerText=r.currentTurn+" turn!");"white"===r.currentTurn?r.currentTurn="black":r.currentTurn="white",t.innerText=r.currentTurn+" turn!"}function u(){t.clear(),t.createCheckBoard(r),t.figuresDraw(r.figures)}function s(e){const t=h(e),o=t.color,a=t.x,i=t.y,c=b(a,i-1),n=b(a+1,i),d=b(a,i+1),u=b(a-1,i),s=b(a+1,i-1),l=b(a+1,i+1),f=b(a-1,i+1),g=b(a-1,i-1);let p,y=[];p="white"===o?-1:1;const k=b(a+1,i+p),q=b(a-1,i+p);let S,m,w,v,E,B,M,x;switch(t.type){case"pawn":if(!r.boardSquare[c]&&"white"===o)break;if(!r.boardSquare[d]&&"black"===o)break;6===t.y&&"white"===o?(r.boardSquare[c].occupied||(r.boardSquare[c].canMove=!0),r.boardSquare[b(a,i-2)].occupied||(r.boardSquare[b(a,i-2)].canMove=!0)):1===t.y&&"black"===o&&(r.boardSquare[d].occupied||(r.boardSquare[d].canMove=!0),r.boardSquare[b(a,i+2)].occupied||(r.boardSquare[b(a,i+2)].canMove=!0)),"white"===o?(p=-1,r.boardSquare[c].occupied||(r.boardSquare[c].canMove=!0)):"black"===o&&(p=1,r.boardSquare[d].occupied||(r.boardSquare[d].canMove=!0)),k&&r.boardSquare[k].occupied&&h(k).color!==o&&(r.boardSquare[k].canMove=!0),q&&r.boardSquare[q].occupied&&h(q).color!==o&&(r.boardSquare[q].canMove=!0),n&&r.boardSquare[n].occupied&&!0===h(n).enPassant&&("white"===o?r.boardSquare[s].canMove=!0:r.boardSquare[l].canMove=!0),u&&r.boardSquare[u].occupied&&!0===h(u).enPassant&&("white"===o?r.boardSquare[g].canMove=!0:r.boardSquare[f].canMove=!0);break;case"rook":y=[{id:c,direction:"top"},{id:n,direction:"right"},{id:d,direction:"bottom"},{id:u,direction:"left"}];break;case"knight":S=b(a+1,i-2),m=b(a-1,i-2),w=b(a+2,i-1),v=b(a+2,i+1),E=b(a+1,i+2),B=b(a-1,i+2),M=b(a-2,i-1),x=b(a-2,i+1),y=[S,m,w,v,E,B,M,x],y.forEach((e=>{void 0!==e&&(r.boardSquare[e].occupied||(r.boardSquare[e].canMove=!0),r.boardSquare[e].occupied&&h(e).color!==o&&(r.boardSquare[e].canMove=!0))}));break;case"bishop":y=[{id:s,direction:"top-right"},{id:l,direction:"bottom-right"},{id:f,direction:"bottom-left"},{id:g,direction:"top-left"}];break;case"queen":y=[{id:c,direction:"top"},{id:n,direction:"right"},{id:d,direction:"bottom"},{id:u,direction:"left"},{id:s,direction:"top-right"},{id:l,direction:"bottom-right"},{id:f,direction:"bottom-left"},{id:g,direction:"top-left"}];break;case"king":y=[c,n,d,u,s,l,f,g],t.castling&&("white"===o?r.boardSquare.f1.occupied||r.boardSquare.g1.occupied||!h("h1").castling?r.boardSquare.d1.occupied||r.boardSquare.c1.occupied||r.boardSquare.b1.occupied||!h("a1").castling||(r.boardSquare.c1.canMove=!0):r.boardSquare.g1.canMove=!0:"black"===o&&(r.boardSquare.f8.occupied||r.boardSquare.g8.occupied||!h("h8").castling?r.boardSquare.d8.occupied||r.boardSquare.c8.occupied||r.boardSquare.b8.occupied||!h("a8").castling||(r.boardSquare.c8.canMove=!0):r.boardSquare.g8.canMove=!0))}y.forEach((e=>{let c,n=e;"king"!==t.type&&"knight"!==t.type&&(n=e.id,c=e.direction);let d=1;for(;n&&void 0!==n;){if(r.boardSquare[n].occupied||(r.boardSquare[n].canMove=!0),r.boardSquare[n].occupied){if(h(n).color===o)break;r.boardSquare[n].canMove=!0;break}if("king"===t.type||"knight"===t.type)break;switch(c){case"top":n=b(a,i-d);break;case"right":n=b(a+d,i);break;case"bottom":n=b(a,i+d);break;case"left":n=b(a-d,i);break;case"top-right":n=b(a+d,i-d);break;case"bottom-right":n=b(a+d,i+d);break;case"bottom-left":n=b(a-d,i+d);break;case"top-left":n=b(a-d,i-d)}d++}}))}function l(){r.figures=[],e.ResetHistory(),d("white"),Object.entries(r.boardSquare).forEach((e=>{delete e[1].canMove,e[1].occupied&&delete e[1].occupied}));for(let e=0;e<8;e++){const r=t.letters[e]+"2",o=t.letters[e]+"7";i(r,"white","pawn"),i(o,"black","pawn")}i("a1","white","rook",!0),i("h1","white","rook",!0),i("a8","black","rook",!0),i("h8","black","rook",!0),i("b1","white","knight"),i("g1","white","knight"),i("b8","black","knight"),i("g8","black","knight"),i("c1","white","bishop"),i("f1","white","bishop"),i("c8","black","bishop"),i("f8","black","bishop"),i("d1","white","queen"),i("e1","white","king",!0),i("d8","black","queen"),i("e8","black","king",!0)}function b(e,o){let a,i=e,c=o;if(i>10&&c>10){const r=t.pixelsToNumbers(e,o);i=r[0],c=r[1]}return Object.entries(r.boardSquare).forEach((e=>{const t=e[1];i===t.x&&c===t.y&&(a=t.id)})),a}function h(e){let t;return r.figures.forEach((r=>{e===r.id&&(t=r)})),t}function f(t,r){const o=h(t.target.dataset.squareId),i=a[0],c=a[1],n=a[2],d=a[3];"yes"===r?(o.type="queen",i?e.AddPromotionCapture(n,c,d):e.AddPromotion(c,d)):i?e.Add("capture",o,d,n):e.Add("regular",o,d),p("no"),u()}function g(e,t){const o=h(t),a=r.boardSquare[e];delete o.castling,o.x=a.x,o.y=a.y,o.id=a.id,a.occupied=!0,delete r.boardSquare[t].occupied}function p(e){const t=document.getElementById("promotion").style,r=document.getElementById("screenBlock").style;"no"===e?(t.display="none",r.display="none"):"yes"===e&&(t.display="initial",r.display="initial")}!function(){let e,o=!0;for(let a=0;a<8;a++){for(let i=0;i<8;i++){const c=""+t.letters[a]+t.numbers[i],n=a,d=i;e=o?"light":"brown",r.boardSquare[c]={id:c,x:n,y:d,color:e},o=!o}o=!o}}(),t.addEventListener("click",(e=>{const a=b(e.offsetX,e.offsetY);let i;var n;h(a)&&(i=h(a).color),a&&i===r.currentTurn&&r.boardSquare[a].occupied&&!1===o&&(o=!0,t.clear(),t.createCheckBoard(r),s(a),function(e){if(e){const o=r.boardSquare[e];t.fillSquare(o.x,o.y,"rgb(159, 227, 159)")}Object.entries(r.boardSquare).forEach((e=>{if(!0!==e[1].canMove)return;const r=h(e[1].id),o=e[1].color;"brown"===o?t.fillSquare(e[1].x,e[1].y,"rgb(63, 38, 13)"):"light"===o&&t.fillSquare(e[1].x,e[1].y,"rgb(155, 122, 44)"),e[1].occupied&&t.fillSquare(e[1].x,e[1].y,"gray"),r&&"king"===r.type&&t.fillSquare(e[1].x,e[1].y,"red")})),t.figuresDraw(r.figures)}(a),h(n=a).color===r.currentTurn?t.addEventListener("click",(e=>{const t=b(e.offsetX,e.offsetY);if(!t)return o=!1,void u();r.boardSquare[t].canMove&&c(t,n),o=!1,u()}),{once:!0}):o=!1)})),u(),l(),document.getElementById("addBtn").addEventListener("click",(function(){const e=document.getElementById("idInput"),t=document.getElementById("dropDownFigures").value,r=document.querySelector('input[type="radio"][name="color"]:checked').value;let o="a8";e.value&&(o=e.value),i(o,r,t)})),document.getElementById("figDefBtn").addEventListener("click",l),document.getElementById("clearBtn").addEventListener("click",(function(){n("all")})),document.getElementById("renderBtn").addEventListener("click",u),document.getElementById("yesButton").addEventListener("click",(function(){f(event,"yes")})),document.getElementById("noButton").addEventListener("click",(function(){f(event,"no")}))})();