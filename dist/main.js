(()=>{"use strict";const e=new class{historyArrayBlack=[];historyArrayWhite=[];Add(e,r,t,o){const a=r;let i,c=a.type[0].toUpperCase();switch("knight"===a.type&&(c="N"),e){case"regular":i="pawn"!==a.type?c+t:t;break;case"capture":i="pawn"!==a.type?c+":"+t:o?o[0]+":"+t:a.id[0]+":"+t;break;case"castling-queen":i="0-0-0";break;case"castling-king":i="0-0"}"white"===a.color?this.historyArrayWhite.push(i):this.historyArrayBlack.push(i),this.Render()}AddPromotion(e,r){const t=r+"Q";"white"===e?this.historyArrayWhite.push(t):this.historyArrayBlack.push(t),this.Render()}AddPromotionCapture(e,r,t){const o=e[0]+":"+t+"Q";"white"===r?this.historyArrayWhite.push(o):this.historyArrayBlack.push(o),this.Render()}ResetHistory(){document.getElementById("blackHistory").innerHTML="",document.getElementById("whiteHistory").innerHTML="",this.historyArrayBlack=[],this.historyArrayWhite=[]}Render(){const e=document.getElementById("blackHistory");e.innerHTML="";const r=document.getElementById("whiteHistory");r.innerHTML="",e.length>35&&e.shift(),r.length>35&&r.shift(),this.historyArrayBlack.forEach((r=>{const t=document.createElement("div");t.innerText=r,t.id="history",e.appendChild(t)})),this.historyArrayWhite.forEach((e=>{const t=document.createElement("div");t.innerText=e,t.id="history",r.appendChild(t)}))}},r=function(){const e=document.getElementById("myCanvas");e.style.backgroundColor="rgb(148, 106, 62)";const r=e.getContext("2d"),t=100,o={king:{black:"♚",white:"♔"},queen:{black:"♛",white:"♕"},rook:{black:"♜",white:"♖"},bishop:{black:"♝",white:"♗"},knight:{black:"♞",white:"♘"},pawn:{black:"♟",white:"♙"}},a=["a","b","c","d","e","f","g","h"],i=[8,7,6,5,4,3,2,1];let c=0;function n(e,r,t,o){const c=""+a[e]+i[r],n=e,d=r;o.boardSquare[c]={id:c,x:n,y:d,color:t}}return{clear:function(){r.clearRect(0,0,e.width,e.height)},figuresDraw:function(e){r.save(),e.forEach((e=>{r.fillStyle="black",r.font="100px serif",r.textAlign="center",r.fillText(o[e.type][e.color],75+e.x*t,110+e.y*t)})),r.restore()},createCheckBoard:function(e){let o=!0;for(let d=0;d<8;d++){const u=d*t;r.fillStyle="black",r.font="25px Arial",r.fillText(a[d],68+u,20),r.fillText(a[d],68+u,844),r.fillText(i[d],5,80+u),r.fillText(i[d],831,80+u);for(let s=0;s<8;s++){const l=s*t;let b;if(o?(r.fillStyle="rgb(209, 173, 90)",b="light"):(r.fillStyle="rgb(94, 57, 19)",b="brown"),c<64&&(n(s,d,b,e),c++),64===c){const t=a[s]+i[d];e.boardSquare[t]&&e.boardSquare[t].check&&(r.fillStyle="red",b="brown")}r.fillRect(25+l,25+u,t,t),o=!o}o=!o}Object.entries(e.boardSquare).forEach((e=>{delete e[1].canMove}))},fillSquare:function(e,o,a){r.fillStyle=a,e<10&&o<10?r.fillRect(25+100*e,25+100*o,t,t):r.fillRect(e,o,t,t)},pixelsToNumbers:function(e,r){const o=e-25,a=r-25;return[Math.trunc(o/t),Math.trunc(a/t)]},numberToPixels:function(e,r){return[e*t+25,r*t+35]},addEventListener:(r,t,o)=>e.addEventListener(r,t,o),letters:a}}(),t={boardSquare:{},figures:[],currentTurn:"white",enPassantStorage:[],arrayOfMoves:[],check:!1};let o=!1,a=[!1];function i(e,r,o,a){let i=!0;t.figures.forEach((r=>{e===r.id&&(i=!1)})),i&&a?t.figures.push({id:e,type:o,color:r,castling:a}):i&&t.figures.push({id:e,type:o,color:r}),c(e),u()}function c(o,i){const c=b(o);if(a[0]=!1,o&&i){const c=t.boardSquare[i],u=t.boardSquare[o],s=b(i);a=[!1,s.color,i,o];let l=!0,f="regular";if(u.occupied&&(f="capture",a[0]=!0),"pawn"===s.type&&(l=function(e,o){if("white"===e.color&&"8"===o[1]||"black"===e.color&&"1"===o[1])return function(e){if(!t.boardSquare[e])return;const o=r.numberToPixels(t.boardSquare[e].x,t.boardSquare[e].y),a=o[0],i=o[1],c=document.getElementById("promotion").style,n=document.getElementById("yesButton"),d=document.getElementById("noButton");n.dataset.squareId=e,d.dataset.squareId=e,c.display="initial",c.left=a+"px",c.top=i+"px",function(e){const r=document.getElementById("promotion").style,t=document.getElementById("screenBlock").style;"no"===e?(r.display="none",t.display="none"):"yes"===e&&(r.display="initial",t.display="initial")}("yes")}(o),!1}(s,o),l=function(r,o){const a=b(r);let i;if(Math.abs(Number(r[1])-Number(o[1]))>1)return a.enPassant=!0,t.enPassantStorage.push(a),!0;if(r[0]!==o[0]){if("white"===a.color){if(i=o[0]+(Number(o[1])-1),!b(i))return!0;"white"!==b(i).color&&b(i).enPassant&&n(i)}else{if(i=o[0]+(Number(o[1])+1),!b(i))return!0;"black"!==b(i).color&&b(i).enPassant&&n(i)}return e.Add("capture",a,o),!1}return!0}(i,o)),s!==t.enPassantStorage[0]&&t.enPassantStorage[0]){const e=t.enPassantStorage[0].id;t.figures.forEach((r=>{r.id===e&&delete r.enPassant})),t.enPassantStorage.shift()}"rook"===s.type&&delete s.castling,"king"===s.type&&(delete s.castling,l=function(r,t){let o=!0;const a=r.id;return"white"===r.color?"e1"===a&&"g1"===t?(h("f1","h1"),e.Add("castling-king",r,r.id),o=!1):"e1"===a&&"c1"===t&&(h("d1","a1"),e.Add("castling-queen",r,r.id),o=!1):"black"===r.color&&("e8"===a&&"g8"===t?(h("f8","h8"),e.Add("castling-king",r,r.id),o=!1):"e8"===a&&"c8"===t&&(h("d8","a8"),e.Add("castling-queen",r,r.id),o=!1)),o}(s,o)),l&&e.Add(f,s,o),n(o),s.x=u.x,s.y=u.y,s.id=u.id,u.occupied=!0,delete c.occupied,d()}var u;i||(t.boardSquare[o].occupied=!0,c.x=t.boardSquare[o].x,c.y=t.boardSquare[o].y),(u=t).arrayOfMoves=[],u.figures.forEach((e=>{s(e.id)})),Object.entries(u.boardSquare).forEach((e=>{e[1].canMove&&u.arrayOfMoves.push(e[1].id)})),function(){let e;Object.entries(t.boardSquare).forEach((e=>{e[1].check&&delete e[1].check}));const r={};t.figures.forEach((e=>{"king"===e.type&&("white"===e.color?r.white=e:r.black=e)})),Object.entries(r).forEach((r=>{const o=r[1];t.boardSquare[o.id].canMove&&(t.check=!0,t.boardSquare[o.id].check=!0,e=r[1])})),e||(t.check=!1)}()}function n(e){"all"===e&&(t.figures=[],Object.entries(t.boardSquare).forEach((e=>delete e[1].occupied)),d("white")),t.figures=t.figures.filter((r=>e!==r.id||(delete t.boardSquare[e].occupied,!1))),u()}function d(e){const r=document.getElementById("turnCount");if(e)return t.currentTurn=e,void(r.innerText=t.currentTurn+" turn!");"white"===t.currentTurn?t.currentTurn="black":t.currentTurn="white",r.innerText=t.currentTurn+" turn!"}function u(){r.clear(),r.createCheckBoard(t),r.figuresDraw(t.figures)}function s(e){const r=b(e),o=r.color,a=r.x,i=r.y,c=l(a,i-1),n=l(a+1,i),d=l(a,i+1),u=l(a-1,i),s=l(a+1,i-1),h=l(a+1,i+1),f=l(a-1,i+1),p=l(a-1,i-1);let g,y=[];g="white"===o?-1:1;const k=l(a+1,i+g),S=l(a-1,i+g);let q,w,m,v,M,x,E,T;switch(r.type){case"pawn":if(!t.boardSquare[c]&&"white"===o)break;if(!t.boardSquare[d]&&"black"===o)break;6===r.y&&"white"===o?(t.boardSquare[c].occupied||(t.boardSquare[c].canMove=!0),t.boardSquare[l(a,i-2)].occupied||(t.boardSquare[l(a,i-2)].canMove=!0)):1===r.y&&"black"===o&&(t.boardSquare[d].occupied||(t.boardSquare[d].canMove=!0),t.boardSquare[l(a,i+2)].occupied||(t.boardSquare[l(a,i+2)].canMove=!0)),"white"===o?(g=-1,t.boardSquare[c].occupied||(t.boardSquare[c].canMove=!0)):"black"===o&&(g=1,t.boardSquare[d].occupied||(t.boardSquare[d].canMove=!0)),k&&t.boardSquare[k].occupied&&b(k).color!==o&&(t.boardSquare[k].canMove=!0),S&&t.boardSquare[S].occupied&&b(S).color!==o&&(t.boardSquare[S].canMove=!0),n&&t.boardSquare[n].occupied&&!0===b(n).enPassant&&("white"===o?t.boardSquare[s].canMove=!0:t.boardSquare[h].canMove=!0),u&&t.boardSquare[u].occupied&&!0===b(u).enPassant&&("white"===o?t.boardSquare[p].canMove=!0:t.boardSquare[f].canMove=!0);break;case"rook":y=[{id:c,direction:"top"},{id:n,direction:"right"},{id:d,direction:"bottom"},{id:u,direction:"left"}];break;case"knight":q=l(a+1,i-2),w=l(a-1,i-2),m=l(a+2,i-1),v=l(a+2,i+1),M=l(a+1,i+2),x=l(a-1,i+2),E=l(a-2,i-1),T=l(a-2,i+1),y=[q,w,m,v,M,x,E,T],y.forEach((e=>{void 0!==e&&(t.boardSquare[e].occupied||(t.boardSquare[e].canMove=!0),t.boardSquare[e].occupied&&b(e).color!==o&&(t.boardSquare[e].canMove=!0))}));break;case"bishop":y=[{id:s,direction:"top-right"},{id:h,direction:"bottom-right"},{id:f,direction:"bottom-left"},{id:p,direction:"top-left"}];break;case"queen":y=[{id:c,direction:"top"},{id:n,direction:"right"},{id:d,direction:"bottom"},{id:u,direction:"left"},{id:s,direction:"top-right"},{id:h,direction:"bottom-right"},{id:f,direction:"bottom-left"},{id:p,direction:"top-left"}];break;case"king":y=[c,n,d,u,s,h,f,p],r.castling&&("white"===o?t.boardSquare.f1.occupied||t.boardSquare.g1.occupied||!b("h1").castling?t.boardSquare.d1.occupied||t.boardSquare.c1.occupied||t.boardSquare.b1.occupied||!b("a1").castling||(t.boardSquare.c1.canMove=!0):t.boardSquare.g1.canMove=!0:"black"===o&&(t.boardSquare.f8.occupied||t.boardSquare.g8.occupied||!b("h8").castling?t.boardSquare.d8.occupied||t.boardSquare.c8.occupied||t.boardSquare.b8.occupied||!b("a8").castling||(t.boardSquare.c8.canMove=!0):t.boardSquare.g8.canMove=!0))}y.forEach((e=>{let c,n=e;"king"!==r.type&&"knight"!==r.type&&(n=e.id,c=e.direction);let d=1;for(;n&&void 0!==n;){if(t.boardSquare[n].occupied||(t.boardSquare[n].canMove=!0),t.boardSquare[n].occupied){if(b(n).color===o)break;t.boardSquare[n].canMove=!0;break}if("king"===r.type||"knight"===r.type)break;switch(c){case"top":n=l(a,i-d);break;case"right":n=l(a+d,i);break;case"bottom":n=l(a,i+d);break;case"left":n=l(a-d,i);break;case"top-right":n=l(a+d,i-d);break;case"bottom-right":n=l(a+d,i+d);break;case"bottom-left":n=l(a-d,i+d);break;case"top-left":n=l(a-d,i-d)}d++}}))}function l(e,o){let a,i=e,c=o;if(i>10&&c>10){const t=r.pixelsToNumbers(e,o);i=t[0],c=t[1]}return Object.entries(t.boardSquare).forEach((e=>{const r=e[1];i===r.x&&c===r.y&&(a=r.id)})),a}function b(e){let r;return t.figures.forEach((t=>{e===t.id&&(r=t)})),r}function h(e,r){const o=b(r),a=t.boardSquare[e];delete o.castling,o.x=a.x,o.y=a.y,o.id=a.id,a.occupied=!0,delete t.boardSquare[r].occupied}r.addEventListener("click",(e=>{const a=l(e.offsetX,e.offsetY);let i;var n;b(a)&&(i=b(a).color),a&&i===t.currentTurn&&t.boardSquare[a].occupied&&!1===o&&(o=!0,r.clear(),r.createCheckBoard(),s(a),function(e){if(e){const o=t.boardSquare[e];r.fillSquare(o.x,o.y,"rgb(159, 227, 159)")}Object.entries(t.boardSquare).forEach((e=>{if(!0!==e[1].canMove)return;const t=b(e[1].id),o=e[1].color;"brown"===o?r.fillSquare(e[1].x,e[1].y,"rgb(63, 38, 13)"):"light"===o&&r.fillSquare(e[1].x,e[1].y,"rgb(155, 122, 44)"),e[1].occupied&&r.fillSquare(e[1].x,e[1].y,"gray"),t&&"king"===t.type&&r.fillSquare(e[1].x,e[1].y,"red")})),r.figuresDraw(t.figures)}(a),b(n=a).color===t.currentTurn?r.addEventListener("click",(e=>{const r=l(e.offsetX,e.offsetY);if(!r)return o=!1,void u();t.boardSquare[r].canMove&&c(r,n),o=!1,u()}),{once:!0}):o=!1)})),u(),function(){t.figures=[],e.ResetHistory(),d("white"),Object.entries(t.boardSquare).forEach((e=>{delete e[1].canMove,e[1].occupied&&delete e[1].occupied}));for(let e=0;e<8;e++){const t=r.letters[e]+"2",o=r.letters[e]+"7";i(t,"white","pawn"),i(o,"black","pawn")}i("a1","white","rook",!0),i("h1","white","rook",!0),i("a8","black","rook",!0),i("h8","black","rook",!0),i("b1","white","knight"),i("g1","white","knight"),i("b8","black","knight"),i("g8","black","knight"),i("c1","white","bishop"),i("f1","white","bishop"),i("c8","black","bishop"),i("f8","black","bishop"),i("d1","white","queen"),i("e1","white","king",!0),i("d8","black","queen"),i("e8","black","king",!0)}()})();